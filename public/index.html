<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Meu Site</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/@material/mdc-typography@13.0.0/dist/mdc-typography.min.css">
  <link rel="stylesheet" href="https://unpkg.com/@material/mdc-button@13.0.0/dist/mdc-button.min.css">
  <link rel="stylesheet" href="styles.css">
</head>

<body>
  <h1>Meu Site</h1>
  <div id="auth-section">
    <p id="user-info">Nenhum usuário logado.</p>
    <button id="sign-in-button" class="mdc-button mdc-button--raised" onclick="signInWithGoogle()">
      Entrar com Google
    </button>
    <button id="sign-out-button" class="mdc-button mdc-button--raised" onclick="signOut()" style="display: none;">
      Sair
    </button>
  </div>

  <div id="tweet-section" style="display: none;">
    <h2>Postar no Twitter</h2>
    <button id="tweet-button" class="mdc-button mdc-button--raised" onclick="postTweet()">
      Postar Tweet
      <span id="tweet-spinner" class="spinner"></span>
    </button>
    <p id="tweet-message"></p>
  </div>

  <div id="etf-section" style="display: none;">
    <h2>Analisar ETFs</h2>
    <button id="etf-button" class="mdc-button mdc-button--raised" onclick="analyzeETFs()">
      Analisar ETFs
      <span id="etf-spinner" class="spinner"></span>
    </button>
    <div id="etf-message"></div>
  </div>

  <div id="linkedin-section" style="display: none;">
    <h2>Gerar Conteúdo no LinkedIn</h2>
    <label for="content-type">Tipo de Conteúdo:</label>
    <select id="content-type" class="mdc-select">
      <option value="POST">Post</option>
      <option value="ARTICLE">Artigo</option>
    </select>
    <div id="article-title-section" style="display: none; margin-top: 10px;">
      <label for="article-title">Título do Artigo:</label>
      <input type="text" id="article-title" class="mdc-text-field" maxlength="100"
        placeholder="Digite o título do artigo">
    </div>
    <button id="linkedin-button" class="mdc-button mdc-button--raised" onclick="generateLinkedInPost()">
      Gerar Conteúdo
      <span id="linkedin-spinner" class="spinner"></span>
    </button>
    <p>Conteúdo gerado (edite se desejar):</p>
    <textarea id="linkedin-message"></textarea>
    <button id="clear-asterisks-button" class="mdc-button mdc-button--outlined" onclick="clearAsterisks()">Limpar
      Asteriscos</button>
    <button id="publish-linkedin-button" class="mdc-button mdc-button--raised" onclick="publishLinkedInPost()"
      style="display: none;">
      Publicar no LinkedIn
      <span id="publish-linkedin-spinner" class="spinner"></span>
    </button>
    <p id="publish-linkedin-message"></p>
    <button id="linkedin-image-button" class="mdc-button mdc-button--raised" onclick="generateLinkedInPostImage()"
      style="display: none;">
      Gerar Imagem para o Conteúdo
      <span id="linkedin-image-spinner" class="spinner"></span>
    </button>
    <p id="linkedin-image-message"></p>
    <img id="linkedin-image-preview" style="display: none;" alt="Imagem gerada para o LinkedIn">
  </div>

  <button id="fetch-stocks-btn">Analisar Ações BESST</button>
  <div id="stock-analysis"></div>

  <script src="https://unpkg.com/@material/mdc-ripple@13.0.0/dist/mdc-ripple.min.js"></script>
  <script src="script.js" type="module"></script>
  <script>
    async function fetchStockAnalysis() {
      try {
        const response = await fetch('https://us-central1-hello-world-firebase-f1b5d.cloudfunctions.net/analyzeStocksByPERatio');
        const data = await response.json();
        if (data.success) {
          renderStockTable(data.data);
        } else {
          console.error('Erro:', data.message);
          document.getElementById('stock-analysis').innerHTML = `<p>Erro: ${data.message}</p>`;
        }
      } catch (error) {
        console.error('Erro ao chamar a função:', error);
        document.getElementById('stock-analysis').innerHTML = `<p>Erro ao chamar a API: ${error.message}</p>`;
      }
    }

    function renderStockTable(data) {
      const container = document.getElementById('stock-analysis');
      let html = '';
      for (const [category, stocks] of Object.entries(data)) {
        html += `<h2>${category}</h2>`;
        html += `<table border="1" style="width: 100%; border-collapse: collapse;">
        <tr><th>Empresa</th><th>Ticker</th><th>Preço (USD)</th><th>P/E Atual</th><th>P/E Indústria</th><th>Sinal</th></tr>`;
        stocks.forEach(stock => {
          html += `<tr>
          <td>${stock.name}</td>
          <td>${stock.ticker}</td>
          <td>${stock.price}</td>
          <td>${stock.peRatio}</td>
          <td>${stock.industryPERatio}</td>
          <td>${stock.signal}</td>
        </tr>`;
        });
        html += `</table><br>`;
      }
      container.innerHTML = html;
    }

    // Adicionar evento de clique ao botão
    document.getElementById('fetch-stocks-btn').addEventListener('click', fetchStockAnalysis);
  </script>
</body>

</html>